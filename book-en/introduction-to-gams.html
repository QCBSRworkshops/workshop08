<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Introduction to GAMs | Workshop 8: Generalized additive models in R</title>
  <meta name="description" content="Generalized additive models in R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Introduction to GAMs | Workshop 8: Generalized additive models in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/qcbsRworkshops/" />
  <meta property="og:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />
  <meta property="og:description" content="Generalized additive models in R" />
  <meta name="github-repo" content="qcbsRworkshops/workshop08" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Introduction to GAMs | Workshop 8: Generalized additive models in R" />
  
  <meta name="twitter:description" content="Generalized additive models in R" />
  <meta name="twitter:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />

<meta name="author" content="Developed and maintained by the contributors of the QCBS R Workshop Series" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="the-linear-modeland-where-if-fails.html"/>
<link rel="next" href="multiple-smooth-terms.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/qcbs-style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="assets/images/csbq_logo_gray_accueil.png"></a></li>
<link rel="icon" type="image/png" href="assets/images/favicon.ico"/>

<li class="divider"></li>
<li class="part"><span><b>QCBS R Workshop Series</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1</b> Code of conduct</a><ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#expected-behaviour"><i class="fa fa-check"></i><b>0.1.1</b> Expected behaviour</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#unacceptable-behaviour"><i class="fa fa-check"></i><b>0.1.2</b> Unacceptable behaviour</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>0.2</b> Contributors</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#contributing"><i class="fa fa-check"></i><b>0.3</b> Contributing</a></li>
</ul></li>
<li class="part"><span><b>Generalized Additive Models in <code>R</code></b></span></li>
<li class="chapter" data-level="1" data-path="summary-and-learning-objectives.html"><a href="summary-and-learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Summary and Learning objectives</a><ul>
<li class="chapter" data-level="1.1" data-path="summary-and-learning-objectives.html"><a href="summary-and-learning-objectives.html#summary"><i class="fa fa-check"></i><b>1.1</b> Summary</a></li>
<li class="chapter" data-level="1.2" data-path="summary-and-learning-objectives.html"><a href="summary-and-learning-objectives.html#learning-objectives"><i class="fa fa-check"></i><b>1.2</b> Learning Objectives</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preparing-for-the-workshop.html"><a href="preparing-for-the-workshop.html"><i class="fa fa-check"></i><b>2</b> Preparing for the workshop</a></li>
<li class="chapter" data-level="3" data-path="the-linear-modeland-where-if-fails.html"><a href="the-linear-modeland-where-if-fails.html"><i class="fa fa-check"></i><b>3</b> The linear modelâ€¦and where if fails</a></li>
<li class="chapter" data-level="4" data-path="introduction-to-gams.html"><a href="introduction-to-gams.html"><i class="fa fa-check"></i><b>4</b> Introduction to GAMs</a><ul>
<li class="chapter" data-level="4.1" data-path="introduction-to-gams.html"><a href="introduction-to-gams.html#challenge-1"><i class="fa fa-check"></i><b>4.1</b> Challenge 1</a><ul>
<li class="chapter" data-level="4.1.1" data-path="introduction-to-gams.html"><a href="introduction-to-gams.html#challenge-1-solution"><i class="fa fa-check"></i><b>4.1.1</b> Challenge 1 Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multiple-smooth-terms.html"><a href="multiple-smooth-terms.html"><i class="fa fa-check"></i><b>5</b> Multiple smooth terms</a><ul>
<li class="chapter" data-level="5.1" data-path="multiple-smooth-terms.html"><a href="multiple-smooth-terms.html#challenge-2"><i class="fa fa-check"></i><b>5.1</b> CHALLENGE 2</a><ul>
<li class="chapter" data-level="5.1.1" data-path="multiple-smooth-terms.html"><a href="multiple-smooth-terms.html#challenge-2-solution"><i class="fa fa-check"></i><b>5.1.1</b> Challenge 2 solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>6</b> Interactions</a></li>
<li class="part"><span><b>Advanced Concepts</b></span></li>
<li class="chapter" data-level="7" data-path="changing-the-basis.html"><a href="changing-the-basis.html"><i class="fa fa-check"></i><b>7</b> Changing the Basis</a></li>
<li class="chapter" data-level="8" data-path="other-distributions.html"><a href="other-distributions.html"><i class="fa fa-check"></i><b>8</b> Other distributions</a><ul>
<li class="chapter" data-level="8.1" data-path="other-distributions.html"><a href="other-distributions.html#visualizing-the-trend-over-time"><i class="fa fa-check"></i><b>8.1</b> Visualizing the trend over time</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="quick-intro-to-generalized-additive-mixed-models-gamms.html"><a href="quick-intro-to-generalized-additive-mixed-models-gamms.html"><i class="fa fa-check"></i><b>9</b> Quick intro to Generalized Additive Mixed Models (GAMMs)</a><ul>
<li class="chapter" data-level="9.1" data-path="quick-intro-to-generalized-additive-mixed-models-gamms.html"><a href="quick-intro-to-generalized-additive-mixed-models-gamms.html#dealing-with-non-independence"><i class="fa fa-check"></i><b>9.1</b> Dealing with non-independence</a></li>
<li class="chapter" data-level="9.2" data-path="quick-intro-to-generalized-additive-mixed-models-gamms.html"><a href="quick-intro-to-generalized-additive-mixed-models-gamms.html#mixed-modelling"><i class="fa fa-check"></i><b>9.2</b> Mixed modelling</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html"><i class="fa fa-check"></i><b>10</b> GAMs behind the scenes</a><ul>
<li class="chapter" data-level="10.1" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html#a-simple-example-a-polynomial-basis"><i class="fa fa-check"></i><b>10.1</b> A simple example: a polynomial basis</a></li>
<li class="chapter" data-level="10.2" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html#another-example-a-cubic-spline-basis"><i class="fa fa-check"></i><b>10.2</b> Another example: a cubic spline basis</a><ul>
<li class="chapter" data-level="10.2.1" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html#controlling-the-degree-of-smoothing-with-penalized-regression-splines"><i class="fa fa-check"></i><b>10.2.1</b> Controlling the degree of smoothing with penalized regression splines</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html#illustration-of-the-principle-behind-cross-validation"><i class="fa fa-check"></i><b>10.3</b> Illustration of the principle behind cross validation</a></li>
<li class="chapter" data-level="10.4" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html#brief-note-on-effective-degrees-of-freedom-edf"><i class="fa fa-check"></i><b>10.4</b> Brief note on effective degrees of freedom (edf)</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>11</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/qcbsRworkshops" target="blank">QCBS R Workshop Series</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop 8: Generalized additive models in <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!------------------------ Hero Image Container --------------------------> 

<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <script src="https://kit.fontawesome.com/6a26f47516.js"></script>
  <script src="assets/qcbs-hideOutput.js"></script>
  <link href="assets/qcbs-style.css" rel="stylesheet">
</head>



<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/images/jean-philippe-delberghe-75xPHEQBmvA-unsplash_hero_image.jpg">
</div>
<div id="introduction-to-gams" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Introduction to GAMs</h1>
<p>Letâ€™s look at an example. First, weâ€™ll generate some data, and plot
it.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="introduction-to-gams.html#cb3-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb3-2"><a href="introduction-to-gams.html#cb3-2"></a><span class="kw">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb3-3"><a href="introduction-to-gams.html#cb3-3"></a>n =<span class="st"> </span><span class="dv">250</span></span>
<span id="cb3-4"><a href="introduction-to-gams.html#cb3-4"></a>x =<span class="st"> </span><span class="kw">runif</span>(n, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb3-5"><a href="introduction-to-gams.html#cb3-5"></a>y_model =<span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>x<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x)</span>
<span id="cb3-6"><a href="introduction-to-gams.html#cb3-6"></a>y_obs =<span class="st"> </span><span class="kw">rnorm</span>(n, y_model, <span class="fl">0.1</span>)</span>
<span id="cb3-7"><a href="introduction-to-gams.html#cb3-7"></a>data_plot =<span class="st"> </span><span class="kw">qplot</span>(x, y_obs) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_model)) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span>
<span id="cb3-8"><a href="introduction-to-gams.html#cb3-8"></a><span class="kw">print</span>(data_plot)</span></code></pre></div>
<p><img src="images/graphic1.1.jpg" width="350" /></p>
<p>We can appreciate that if we were to fit this as a linear regression
model, we would violate the assumptions listed above. Letâ€™s have a
look, using the <code>gam()</code> command from the <code>mgcv</code> package here to model an
ordinary least squares regression <em>(we will see below how to use <code>gam()</code>
to specify a smoothed, non-linear term)</em>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="introduction-to-gams.html#cb4-1"></a><span class="kw">library</span>(mgcv)</span>
<span id="cb4-2"><a href="introduction-to-gams.html#cb4-2"></a>linear_model =<span class="st"> </span><span class="kw">gam</span>(y_obs <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb4-3"><a href="introduction-to-gams.html#cb4-3"></a>model_summary =<span class="st"> </span><span class="kw">summary</span>(linear_model)</span>
<span id="cb4-4"><a href="introduction-to-gams.html#cb4-4"></a><span class="kw">print</span>(model_summary)</span>
<span id="cb4-5"><a href="introduction-to-gams.html#cb4-5"></a>data_plot =<span class="st"> </span>data_plot <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fitted</span>(linear_model)))</span>
<span id="cb4-6"><a href="introduction-to-gams.html#cb4-6"></a><span class="kw">print</span>(data_plot)</span></code></pre></div>
<p>We can see in the model summary that our linear model explains quite a
bit of variance (<em>R<sup>2</sup><sub>adj</sub></em> = 0.639), however, diagnostic plots of the
model residuals would quickly show that the error variance is not
normally distributed nor homoscedastic, and that an important non-linear
pattern remains. Letâ€™s now try to fix this by fitting the data using a
smoothed (non-linear) term.</p>
<p>We will revisit this later, but briefly, GAMs are effectively a
nonparametric form of regression where the <em>Î²x<sub>i</sub></em> of a
linear regression is replaced by an arbitrary smooth functions of the
explanatory variables, <em>f(x<sub>i</sub>)</em>, and the model becomes:</p>
<p><span class="math display">\[y_i = f(x_i) + Îµ_i\]</span></p>
<p>where <em>y<sub>i</sub></em> is the response variable, <em>x<sub>i</sub></em> is the covariate, and <em>f</em> is the
smooth function.</p>
<p>Importantly, given that the smooth function <em>f(x<sub>i</sub>)</em> is non-linear and
local, the magnitude of the effect of the explanatory variable can vary
over its range, depending on the relationship between the variable and
the response. That is, as opposed to one fixed coefficient beta,
the function <em>f</em> can continually change over the range of <em>x<sub>i</sub></em>.
The degree of smoothness (or wiggliness) of <em>f</em> is controlled using
penalized regression determined automatically in <code>mgcv</code> using a
generalized cross-validation (GCV) routine (Wood 2006).</p>
<p>In <code>gam()</code> smooth terms are specified by expressions of the form: <code>s(x)</code>
where x is the covariate which the smooth is a function of.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="introduction-to-gams.html#cb5-1"></a>gam_model =<span class="st"> </span><span class="kw">gam</span>(y_obs <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x))</span>
<span id="cb5-2"><a href="introduction-to-gams.html#cb5-2"></a><span class="kw">summary</span>(gam_model)</span>
<span id="cb5-3"><a href="introduction-to-gams.html#cb5-3"></a>data_plot =<span class="st"> </span>data_plot <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fitted</span>(gam_model)))</span>
<span id="cb5-4"><a href="introduction-to-gams.html#cb5-4"></a><span class="kw">print</span>(data_plot)</span></code></pre></div>
<p>The variance explained by our model has increased by 20% (<em>R<sup>2</sup><sub>adj</sub></em> =
0.859) and when we compare the fit of the linear (red) and non-linear
(blue) models, it is clear that the latter is the winner.</p>
<p><img src="images/graphic1.3.jpg" width="375" /></p>
<p>The <code>mgcv</code> package also includes a default plot to look at the smooths:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="introduction-to-gams.html#cb6-1"></a><span class="kw">plot</span>(gam_model)</span></code></pre></div>
<p>How do we test whether the non-linear model offers a significant
improvement over the linear model? We can use the <code>gam()</code> and <code>anova()</code>
commands to formally test whether an assumption of linearity is
justified. To do, we must simply set our smoothed model so that it is
nested in our linear model; that is, we create model object that
includes both <code>x</code> (linear) and <code>s(x)</code> (non-linear) and we ask whether
adding <code>s(x)</code> to the model with only <code>x</code> as a covariate is supported by
the data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="introduction-to-gams.html#cb7-1"></a>linear_model =<span class="st"> </span><span class="kw">gam</span>(y_obs <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb7-2"><a href="introduction-to-gams.html#cb7-2"></a>nested_gam_model =<span class="st"> </span><span class="kw">gam</span>(y_obs <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x) <span class="op">+</span><span class="st"> </span>x)</span>
<span id="cb7-3"><a href="introduction-to-gams.html#cb7-3"></a><span class="kw">print</span>(<span class="kw">anova</span>(linear_model, nested_gam_model, <span class="dt">test =</span> <span class="st">&quot;Chisq&quot;</span>))</span></code></pre></div>
<p>The non-linear term is significant:</p>
<pre><code> Analysis of Deviance Table
 Model 1: y_obs ~ x
 Model 2: y_obs ~ s(x) + x
       Resid. Df    Resid. Dev     Df        Deviance    Pr(&gt;Chi)    
 1    248.00        6.5846                              
 2    240.68        2.4988         7.3168    4.0858      &lt; 2.2e-16 ***
 ---
 Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1</code></pre>
<p>Note that the model <code>y_obs~s(x)</code> gives exactly the same results as
<code>y_obs~s(x)+x</code>, as shown above for the <code>nested_gam_model</code>. We used the
<code>s(x)+x</code> to illustrate the nestedness of the model, however, we will
omit the <code>+x</code> in the nested model comparisons that follow.</p>
<div id="challenge-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Challenge 1</h2>
<p>We will now try this test with some new simulated data, just to get a
handle on it. First generate the data using the code below, then fit a
linear and smoothed GAM model to the relation between <code>x_test</code> and
<code>y_test_obs</code>. What is the effective degrees of freedom of the smoothed
term? Determine if linearity is justified for this data.</p>
<pre class="{.rsplus|}"><code>n &lt;- 250
x_test &lt;- runif(n,-5,5)
y_test_fit &lt;- 4*dnorm(x_test)
y_test_obs &lt;- rnorm(n,y_test_fit, 0.2)</code></pre>
<div id="challenge-1-solution" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Challenge 1 Solution</h3>
<pre class="{.rsplus|}"><code>data_plot &lt;- qplot(x_test, y_test_obs) + 
  geom_line(aes(y=y_test_fit))+
  theme_bw()
print(data_plot)

linear_model_test &lt;- gam(y_test_obs~x_test)
nested_gam_model_test &lt;- gam(y_test_obs~s(x_test)+x_test)
print(anova(linear_model_test, nested_gam_model_test, test=&quot;Chisq&quot;))

summary(nested_gam_model_test)$s.table</code></pre>
<pre><code>Analysis of Deviance Table


Model 1: y_test_obs ~ x_test
Model 2: y_test_obs ~ s(x_test) + x_test
     Resid. Df   Resid. Dev    Df      Deviance   Pr(&gt;Chi)    
1     248.0      81.09                              
2     240.5      7.46          7.5012   73.629    &lt; 2.2e-16 ***
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

               edf   Ref.df        F p-value
s(x_test) 7.602145 8.029057 294.0944       0</code></pre>
<p>Answer: Yes non-linearity is justified. The effective degrees of freedom
(edf) are &gt;&gt; 1.</p>
<p><img src="images/challenge_1_soln.jpg" width="350" /></p>

</div>
</div>
</div>
<hr>
<center> 
  <div class="footer">
      All the content of the workshop series is under a <a href="https://creativecommons.org/licenses/by-nc/2.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="the-linear-modeland-where-if-fails.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multiple-smooth-terms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

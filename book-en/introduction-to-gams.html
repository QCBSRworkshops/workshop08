<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Introduction to GAMs | Workshop 8: Generalized additive models in R</title>
  <meta name="description" content="Generalized additive models in R" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Introduction to GAMs | Workshop 8: Generalized additive models in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/qcbsRworkshops/" />
  <meta property="og:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />
  <meta property="og:description" content="Generalized additive models in R" />
  <meta name="github-repo" content="qcbsRworkshops/workshop08" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Introduction to GAMs | Workshop 8: Generalized additive models in R" />
  
  <meta name="twitter:description" content="Generalized additive models in R" />
  <meta name="twitter:image" content="https://github.com/qcbsRworkshops/assets/images/logo/csbq_logo_accueil.png" />

<meta name="author" content="Developed and maintained by the contributors of the QCBS R Workshop Series" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="intro-linear-models.html"/>
<link rel="next" href="multiple-smooth-terms.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="assets/qcbs-style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="assets/images/csbq_logo_gray_accueil.png"></a></li>
<link rel="icon" type="image/png" href="assets/images/favicon.ico"/>

<li class="divider"></li>
<li class="part"><span><b>QCBS R Workshop Series</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1</b> Code of conduct</a><ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#expected-behaviour"><i class="fa fa-check"></i><b>0.1.1</b> Expected behaviour</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#unacceptable-behaviour"><i class="fa fa-check"></i><b>0.1.2</b> Unacceptable behaviour</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>0.2</b> Contributors</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#contributing"><i class="fa fa-check"></i><b>0.3</b> Contributing</a></li>
</ul></li>
<li class="part"><span><b>Generalized Additive Models in <code>R</code></b></span></li>
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning objectives</a></li>
<li class="chapter" data-level="2" data-path="preparing-for-the-workshop.html"><a href="preparing-for-the-workshop.html"><i class="fa fa-check"></i><b>2</b> Preparing for the workshop</a></li>
<li class="chapter" data-level="3" data-path="intro-linear-models.html"><a href="intro-linear-models.html"><i class="fa fa-check"></i><b>3</b> The linear model…and where it fails</a></li>
<li class="chapter" data-level="4" data-path="introduction-to-gams.html"><a href="introduction-to-gams.html"><i class="fa fa-check"></i><b>4</b> Introduction to GAMs</a><ul>
<li class="chapter" data-level="4.1" data-path="introduction-to-gams.html"><a href="introduction-to-gams.html#test-for-linearity"><i class="fa fa-check"></i><b>4.1</b> Test for linearity</a></li>
<li class="chapter" data-level="4.2" data-path="introduction-to-gams.html"><a href="introduction-to-gams.html#challenge-1"><i class="fa fa-check"></i><b>4.2</b> Challenge 1</a><ul>
<li class="chapter" data-level="4.2.1" data-path="introduction-to-gams.html"><a href="introduction-to-gams.html#challenge-1-solution"><i class="fa fa-check"></i><b>4.2.1</b> Challenge 1: Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multiple-smooth-terms.html"><a href="multiple-smooth-terms.html"><i class="fa fa-check"></i><b>5</b> Multiple smooth terms</a><ul>
<li class="chapter" data-level="5.1" data-path="multiple-smooth-terms.html"><a href="multiple-smooth-terms.html#challenge-2"><i class="fa fa-check"></i><b>5.1</b> CHALLENGE 2</a><ul>
<li class="chapter" data-level="5.1.1" data-path="multiple-smooth-terms.html"><a href="multiple-smooth-terms.html#challenge-2-solution"><i class="fa fa-check"></i><b>5.1.1</b> Challenge 2 solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>6</b> Interactions</a></li>
<li class="part"><span><b>Advanced Concepts</b></span></li>
<li class="chapter" data-level="7" data-path="changing-the-basis.html"><a href="changing-the-basis.html"><i class="fa fa-check"></i><b>7</b> Changing the Basis</a></li>
<li class="chapter" data-level="8" data-path="other-distributions.html"><a href="other-distributions.html"><i class="fa fa-check"></i><b>8</b> Other distributions</a><ul>
<li class="chapter" data-level="8.1" data-path="other-distributions.html"><a href="other-distributions.html#visualizing-the-trend-over-time"><i class="fa fa-check"></i><b>8.1</b> Visualizing the trend over time</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="quick-intro-to-generalized-additive-mixed-models-gamms.html"><a href="quick-intro-to-generalized-additive-mixed-models-gamms.html"><i class="fa fa-check"></i><b>9</b> Quick intro to Generalized Additive Mixed Models (GAMMs)</a><ul>
<li class="chapter" data-level="9.1" data-path="quick-intro-to-generalized-additive-mixed-models-gamms.html"><a href="quick-intro-to-generalized-additive-mixed-models-gamms.html#dealing-with-non-independence"><i class="fa fa-check"></i><b>9.1</b> Dealing with non-independence</a></li>
<li class="chapter" data-level="9.2" data-path="quick-intro-to-generalized-additive-mixed-models-gamms.html"><a href="quick-intro-to-generalized-additive-mixed-models-gamms.html#mixed-modelling"><i class="fa fa-check"></i><b>9.2</b> Mixed modelling</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html"><i class="fa fa-check"></i><b>10</b> GAMs behind the scenes</a><ul>
<li class="chapter" data-level="10.1" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html#a-simple-example-a-polynomial-basis"><i class="fa fa-check"></i><b>10.1</b> A simple example: a polynomial basis</a></li>
<li class="chapter" data-level="10.2" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html#another-example-a-cubic-spline-basis"><i class="fa fa-check"></i><b>10.2</b> Another example: a cubic spline basis</a><ul>
<li class="chapter" data-level="10.2.1" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html#controlling-the-degree-of-smoothing-with-penalized-regression-splines"><i class="fa fa-check"></i><b>10.2.1</b> Controlling the degree of smoothing with penalized regression splines</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html#illustration-of-the-principle-behind-cross-validation"><i class="fa fa-check"></i><b>10.3</b> Illustration of the principle behind cross validation</a></li>
<li class="chapter" data-level="10.4" data-path="gams-behind-the-scenes.html"><a href="gams-behind-the-scenes.html#brief-note-on-effective-degrees-of-freedom-edf"><i class="fa fa-check"></i><b>10.4</b> Brief note on effective degrees of freedom (edf)</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>11</b> Resources</a></li>
<li class="chapter" data-level="12" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/qcbsRworkshops" target="blank">QCBS R Workshop Series</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop 8: Generalized additive models in <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!------------------------ Hero Image Container --------------------------> 

<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <script src="https://kit.fontawesome.com/6a26f47516.js"></script>
  <script src="assets/qcbs-hideOutput.js"></script>
  <link href="assets/qcbs-style.css" rel="stylesheet">
</head>


<!-- 
<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/images/jean-philippe-delberghe-75xPHEQBmvA-unsplash_hero_image.jpg">
</div>
--!>
<div id="introduction-to-gams" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Introduction to GAMs</h1>
<p>Let us use an example to demonstrate the difference between a linear regression and an additive model.</p>
<p>First, we will load the <code>ISIT</code> dataset. This dataset is comprised of bioluminescence levels (<code>Sources</code>) in relation to depth, seasons and different stations.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="introduction-to-gams.html#cb2-1"></a>isit &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/ISIT.csv&quot;</span>)</span>
<span id="cb2-2"><a href="introduction-to-gams.html#cb2-2"></a><span class="kw">head</span>(isit)</span></code></pre></div>
<pre><code>##   SampleDepth Sources Station Time Latitude Longitude     Xkm    Ykm Month Year
## 1         517   28.73       1    3  50.1508  -14.4792 -34.106 16.779     4 2001
## 2         582   27.90       1    3  50.1508  -14.4792 -34.106 16.779     4 2001
## 3         547   23.44       1    3  50.1508  -14.4792 -34.106 16.779     4 2001
## 4         614   18.33       1    3  50.1508  -14.4792 -34.106 16.779     4 2001
## 5        1068   12.38       1    3  50.1508  -14.4792 -34.106 16.779     4 2001
## 6        1005   11.23       1    3  50.1508  -14.4792 -34.106 16.779     4 2001
##   BottomDepth Season Discovery RelativeDepth
## 1        3939      1       252          3422
## 2        3939      1       252          3357
## 3        3939      1       252          3392
## 4        3939      1       252          3325
## 5        3939      1       252          2871
## 6        3939      1       252          2934</code></pre>
<p>For now, we will be focusing on Season 2.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="introduction-to-gams.html#cb4-1"></a>isit2 &lt;-<span class="st"> </span><span class="kw">subset</span>(isit, Season <span class="op">==</span><span class="st"> </span><span class="dv">2</span>)</span></code></pre></div>
<p>Let’s begin by trying to fit a linear regression model to the relationship between <code>Sources</code> and <code>SampleDepth</code>. We can use the <code>gam()</code> command from the <code>mgcv</code> package here to model an ordinary least squares regression. We will see below how to use <code>gam()</code> to specify a smoothed, non-linear term.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="introduction-to-gams.html#cb5-1"></a>linear_model &lt;-<span class="st"> </span><span class="kw">gam</span>(Sources <span class="op">~</span><span class="st"> </span>SampleDepth, <span class="dt">data =</span> isit2)</span>
<span id="cb5-2"><a href="introduction-to-gams.html#cb5-2"></a><span class="kw">summary</span>(linear_model)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## Sources ~ SampleDepth
## 
## Parametric coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 30.9021874  0.7963891   38.80   &lt;2e-16 ***
## SampleDepth -0.0083450  0.0003283  -25.42   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## R-sq.(adj) =  0.588   Deviance explained = 58.9%
## GCV =  60.19  Scale est. = 59.924    n = 453</code></pre>
<p>The linear model is explaining quite a bit of variance in our dataset (<span class="math inline">\(R_{adj}\)</span> = 0.588), which means it’s a pretty good model, right? Well, let’s take a look at how our model fits the data:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="introduction-to-gams.html#cb7-1"></a>data_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> isit2, <span class="kw">aes</span>(<span class="dt">y =</span> Sources, <span class="dt">x =</span> SampleDepth)) <span class="op">+</span></span>
<span id="cb7-2"><a href="introduction-to-gams.html#cb7-2"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fitted</span>(linear_model)), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb7-3"><a href="introduction-to-gams.html#cb7-3"></a>    <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span>
<span id="cb7-4"><a href="introduction-to-gams.html#cb7-4"></a>data_plot</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Are the assumptions of linear regression listed in <a href="intro-linear-models.html#intro-linear-models">Chapter 2</a> met in this case? As you may have noticed, we are violating the assumptions of the linear model:</p>
<ol style="list-style-type: decimal">
<li>There is a strong <em>non-linear</em> relationship between <code>Sources</code> and <code>SampleDepth</code>.</li>
<li>The error is <em>not</em> normally distributed.</li>
<li>The variance of the error is <em>not</em> homoscedastic.</li>
<li>The errors are <em>not</em> independent of each other.</li>
</ol>
<p>As we mentioned briefly in <a href="intro-linear-models.html#intro-linear-models">Chapter 2</a>, we could manually specify a linear model with multiple predictor variables to try to accommodate this non-linear response. For example, we could try to build this linear model with multiple predictors:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1(x_{1,i}) + \beta_2(x_{2,i}) + ... + \epsilon\]</span>
However, the fit of this model would be determined manually based on the modeller’s decisions, and would quickly become difficult to work with. One big advantage of using an additive model, such as a GAM, is that the fitting method (usually maximum likelihood) automatically determines the optimal shape of the curve fit for non-linear responses. This optimal shape is, in other words, <em>the degree of smoothness</em> of <span class="math inline">\(f(x)\)</span>.</p>
<div class="explanation">
<p>Briefly, GAMs are effectively a nonparametric form of regression where the <span class="math inline">\(\beta x_i\)</span> of a linear regression is replaced by a smooth function of the explanatory variables, <span class="math inline">\(f(x_i)\)</span>, and the model becomes:</p>
<p><span class="math display">\[y_i = f(x_i) + \epsilon_i\]</span>
where <span class="math inline">\(y_i\)</span> is the response variable, <span class="math inline">\(x_i\)</span> is the predictor variable, and <span class="math inline">\(f\)</span> is the smooth function.</p>
<p>Importantly, given that the smooth function <span class="math inline">\(f(x_i)\)</span> is non-linear and
local, the magnitude of the effect of the explanatory variable can vary
over its range, depending on the relationship between the variable and
the response.</p>
<p>That is, as opposed to one fixed coefficient <span class="math inline">\(\beta\)</span>, the function <span class="math inline">\(f\)</span> can continually change over the range of <span class="math inline">\(x_i\)</span>.
The degree of smoothness (or wiggliness) of <span class="math inline">\(f\)</span> is controlled using penalized regression determined automatically in <code>mgcv</code> using a generalized cross-validation (GCV) routine <span class="citation">(Wood <a href="#ref-wood_2006" role="doc-biblioref">2006</a>)</span>.</p>
</div>
<p>We can try to build a more appropriate model by fitting the data with a smoothed (non-linear) term. In <code>mgcv::gam()</code>, smooth terms are specified by expressions of the form <code>s(x)</code>, where <span class="math inline">\(x\)</span> is the non-linear predictor variable we want to smooth. In this case, we want to apply a smooth function to <code>SampleDepth</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="introduction-to-gams.html#cb8-1"></a>gam_model &lt;-<span class="st"> </span><span class="kw">gam</span>(Sources <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(SampleDepth), <span class="dt">data =</span> isit2)</span>
<span id="cb8-2"><a href="introduction-to-gams.html#cb8-2"></a><span class="kw">summary</span>(gam_model)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## Sources ~ s(SampleDepth)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  12.8937     0.2471   52.17   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                  edf Ref.df     F p-value    
## s(SampleDepth) 8.908  8.998 214.1  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =   0.81   Deviance explained = 81.4%
## GCV = 28.287  Scale est. = 27.669    n = 453</code></pre>
<p>The variance explained by our model has increased by more than 20% (<span class="math inline">\(R_{adj}\)</span> = 0.81)! When we compare the fit of the linear (red) and non-linear (blue) models, it is clear that the latter is more appropriate for our dataset:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="introduction-to-gams.html#cb10-1"></a>data_plot &lt;-<span class="st"> </span>data_plot <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fitted</span>(gam_model)),</span>
<span id="cb10-2"><a href="introduction-to-gams.html#cb10-2"></a>    <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>)</span>
<span id="cb10-3"><a href="introduction-to-gams.html#cb10-3"></a>data_plot</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="explanation">
<p>Recall: As opposed to one fixed coefficient <span class="math inline">\(\beta\)</span> in a linear model, the function <span class="math inline">\(f\)</span> can vary across the range of <span class="math inline">\(x_i\)</span>.</p>
</div>
<p>The <code>mgcv</code> package also includes a default plot to look at the smooths:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="introduction-to-gams.html#cb11-1"></a><span class="kw">plot</span>(gam_model)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div id="test-for-linearity" class="section level2">
<h2><span class="header-section-number">4.1</span> Test for linearity</h2>
<p>How do we test whether the non-linear model offers a significant improvement over the linear model?</p>
<p>We can use <code>gam()</code> and <code>AIC()</code> to test whether an assumption of linearity is justified. To do so, we can compare the performance of a linear model containing <code>x</code> as a linear predictor to the performance of a non-linear model containing <code>s(x)</code> as a smooth predictor. In other words, we ask whether adding a smooth function to the linear model improves the fit of the model to our dataset.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="introduction-to-gams.html#cb12-1"></a>linear_model &lt;-<span class="st"> </span><span class="kw">gam</span>(Sources <span class="op">~</span><span class="st"> </span>SampleDepth, <span class="dt">data =</span> isit2)</span>
<span id="cb12-2"><a href="introduction-to-gams.html#cb12-2"></a>smooth_model &lt;-<span class="st"> </span><span class="kw">gam</span>(Sources <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(SampleDepth), <span class="dt">data =</span> isit2)</span>
<span id="cb12-3"><a href="introduction-to-gams.html#cb12-3"></a><span class="kw">AIC</span>(linear_model, smooth_model)</span></code></pre></div>
<pre><code>##                    df      AIC
## linear_model  3.00000 3143.720
## smooth_model 10.90825 2801.451</code></pre>
<p>Here, the AIC of the smooth GAM is lower, which indicates that adding a smoothing function improves model performance. Linearity is therefore not supported by our data.</p>
<div class="explanation">
<p>As a brief explanation, the Akaike Information Criterion (AIC) is a comparative metric of model performance, where lower scores indicate that a model is performing “better” compared to other considered models.</p>
</div>
</div>
<div id="challenge-1" class="section level2">
<h2><span class="header-section-number">4.2</span> Challenge 1</h2>
<p>We will now try to determine whether this the data recorded in the first season should be modelled with a linear regression, or with an additive model. Let’s repeat the comparison test with <code>gam()</code> and <code>AIC()</code> using the data recorded in the first season only:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="introduction-to-gams.html#cb14-1"></a>isit1 &lt;-<span class="st"> </span><span class="kw">subset</span>(isit, Season <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Fit a linear and smoothed GAM model to the relation between <code>SampleDepth</code> and <code>Sources</code>.</li>
<li>Determine if linearity is justified for this data.</li>
<li>How many effective degrees of freedom does the smoothed term have?</li>
</ol>
<div class="explanation">
<p>We have not discussed effective degrees of freedom (<strong>EDF</strong>) yet, but these are a key tool to help us interpret the fit of a GAM. Keep this term in mind. More on this in the next sections!</p>
</div>
<div id="challenge-1-solution" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Challenge 1: Solution</h3>
<p><strong>1.</strong> Fit a linear and smoothed GAM model to the relation between <code>SampleDepth</code> and <code>Sources</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="introduction-to-gams.html#cb15-1"></a>linear_model_s1 &lt;-<span class="st"> </span><span class="kw">gam</span>(Sources <span class="op">~</span><span class="st"> </span>SampleDepth, <span class="dt">data =</span> isit1)</span>
<span id="cb15-2"><a href="introduction-to-gams.html#cb15-2"></a>smooth_model_s1 &lt;-<span class="st"> </span><span class="kw">gam</span>(Sources <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(SampleDepth), <span class="dt">data =</span> isit1)</span></code></pre></div>
<p><strong>2.</strong> Determine whether a linear model is appropriate for this data.</p>
<p>As before, visualizing the model fit on our dataset is an excellent first step to determine whether our model is performing well.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="introduction-to-gams.html#cb16-1"></a><span class="kw">ggplot</span>(isit1, <span class="kw">aes</span>(<span class="dt">x =</span> SampleDepth, <span class="dt">y =</span> Sources)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb16-2"><a href="introduction-to-gams.html#cb16-2"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fitted</span>(linear_model_s1))) <span class="op">+</span></span>
<span id="cb16-3"><a href="introduction-to-gams.html#cb16-3"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fitted</span>(smooth_model_s1))) <span class="op">+</span></span>
<span id="cb16-4"><a href="introduction-to-gams.html#cb16-4"></a><span class="st">    </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>We can supplement this with a quantitative comparison of model performance using <code>AIC()</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="introduction-to-gams.html#cb17-1"></a><span class="kw">AIC</span>(linear_model_s1, smooth_model_s1)</span></code></pre></div>
<pre><code>##                       df      AIC
## linear_model_s1 3.000000 2324.905
## smooth_model_s1 9.644938 2121.249</code></pre>
<p>The lower AIC score indicates that smooth model is performing better than the linear model, which confirms that linearity is not appropriate for our dataset.</p>
<p><strong>3.</strong> How many effective degrees of freedom does the smoothed term have?</p>
<p>To get the effective degrees of freedom, we can simply print the model object:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="introduction-to-gams.html#cb19-1"></a>smooth_model_s1</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## Sources ~ s(SampleDepth)
## 
## Estimated degrees of freedom:
## 7.64  total = 8.64 
## 
## GCV score: 32.13946</code></pre>
<p>The effective degrees of freedom (EDF) are &gt;&gt; 1. Keep this in mind, because we will be coming back to EDF soon!</p>

</div>
</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-wood_2006">
<p>Wood, S. N. 2006. <em>Generalized Additive Models: An Introduction with R</em>. 2nd ed. Chapman; Hall/CRC.</p>
</div>
</div>
<hr>
<center> 
  <div class="footer">
      All the content of the workshop series is under a <a href="https://creativecommons.org/licenses/by-nc/2.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="intro-linear-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multiple-smooth-terms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
